/**
 * jeefo     : v0.0.17
 * Author    : je3f0o, <je3f0o@gmail.com>
 * Homepage  : https://github.com/je3f0o/jeefo
 * License   : The MIT License
 * Copyright : 2016
 **/
"use strict";module.exports=function(){var e=Array,n=e.isArray,r=Object.keys,t=function(e){for(var n,t,i,o=1;o<arguments.length;++o)if(n=arguments[o])for(t=r(n),i=t.length-1;i>=0;e[t[i]]=n[t[i]],--i);return e},i=function(e){throw new Error(e)},o=function(n,r){var t=[],o={};return function s(u,c){for(var d=c.length-1,a=new e(d+1),f=r(u);d>=0;a[d]=c[d],--d);for(a.push(u),o[u]=!0,d=0;d<f.length;++d)a.indexOf(f[d])>=0&&i("Circular dependency '"+f[d]+" is required by '"+n+"' : "+a.join(" -> ")),o.hasOwnProperty(f[d])||s(f[d],a);-1===t.indexOf(u)&&t.push(u)}(n,[]),t},s=function(e){function n(){return 0===i}function r(e,n){return new s(function(r,s){switch(i){case 1:return r(e(t));case 2:return s(n(t));default:o[c]=e,o[c+1]=n,o[c+2]=r,o[c+3]=s,c+=4}})}var t,i=0,o=[],u=this,c=0;return u.then=r,u.state="pending...",u.is_pending=n,e(function(e){if(0===i){i=1,u.state="resolved",u.value=t=e;for(var n=0;n<c;n+=4)e=o[n](t),e&&"JEEFO_PROMISE"===e.type?e.then(o[n+2],o[n+3]):o[n+2](e);o=null,c=0}},function(e){if(0===i){i=2,u.state="rejected",u.reason=t=e;for(var n=1;n<c;n+=4)e=o[n](t),e&&"JEEFO_PROMISE"===e.type?e.then(o[n+1],o[n+2]):o[n+2](e);o=null,c=0}}),u};s.prototype.type="JEEFO_PROMISE";var u={defer:function(){var e={};return e.promise=new s(function(n,r){e.resolve=n,e.reject=r}),e},when:function(e){return e&&"JEEFO_PROMISE"===e.type?e:new s(function(n){n(e)})},for_each_async:function(e,n){function r(){++t<e.length?n.call(e,e[t],t,r,e):i.resolve()}var t=-1,i=this.defer();return r(),i.promise},all:function(e){for(var n,r=0,t=this.defer(),i=0;r<e.length;++r)(n=e[r])&&"JEEFO_PROMISE"===n.type&&(i+=1,n.then(function(n){return function(r){e[n]=r,0===--i&&t.resolve(e)}}(r)));return 0===i&&t.resolve(e),t.promise}},c=function(e){this.values=t({},e),this.definitions={}},d=[];c.prototype={register:function(n,r){if(r.dependencies){for(var t=new e(r.dependencies.length),o=t.length-1;o>=0;t[o]=r.dependencies[o],--o);(this.values.hasOwnProperty(n)||this.definitions.hasOwnProperty(n))&&i("Duplicated provider "+n+" detected."),this.definitions[n]={fn:r.fn,dependencies:t,is_constructor:!!r.is_constructor}}else this.definitions[n]={fn:r.fn,dependencies:d,is_constructor:!!r.is_constructor};return this},resolve:function(n,r){var t,s=this.values,c=this.definitions,d=r&&r.values||{},a=r&&r.definitions;return d.hasOwnProperty(n)?d[n]&&"JEEFO_PROMISE"===d[n].type?d[n]:u.when(d[n]):s.hasOwnProperty(n)?s[n]&&"JEEFO_PROMISE"===s[n].type?s[n]:u.when(s[n]):(t=o(n,function(e){return a&&a.hasOwnProperty(e)?a[e].dependencies:c.hasOwnProperty(e)?c[e].dependencies:void i("Injector '"+e+"' definition is not found.")}),u.for_each_async(t,function(n,r,t){var o,u;if(d.hasOwnProperty(n)||s.hasOwnProperty(n))return t();a&&a.hasOwnProperty(n)?(o=d,u=a[n]):(o=s,u=c[n]);for(var f=u.dependencies.length-1,p=new e(f+1);f>=0;--f)d.hasOwnProperty(u.dependencies[f])?p[f]=d[u.dependencies[f]]:s.hasOwnProperty(u.dependencies[f])?p[f]=s[u.dependencies[f]]:i("OMG");var l=u.fn.apply(null,p);u.is_constructor&&(l=new l),l&&"JEEFO_PROMISE"===l.type?l.then(function(e){o[n]=e,t()}):(o[n]=l,t())}).then(function(){return d.hasOwnProperty(n)?d[n]:s[n]}))},resolve_sync:function(n,r){var t,s=this,u=s.values,c=r&&r.values||{},d=s.definitions,a=r&&r.definitions;if(c.hasOwnProperty(n))return c[n];if(u.hasOwnProperty(n))return u[n];a&&a.hasOwnProperty(n)?t=c:d.hasOwnProperty(n)&&(t=u);for(var f=o(n,function(e){return a&&a.hasOwnProperty(e)?a[e].dependencies:d.hasOwnProperty(e)?d[e].dependencies:void i("Injector '"+e+"' definition is not found.")}),p=d[f.pop()],l=new e(p.dependencies.length),h=0;h<f.length;++h)c.hasOwnProperty(f[h])||u.hasOwnProperty(f[h])||s.resolve_sync(f[h],r);for(h=l.length-1;h>=0;--h)l[h]=c.hasOwnProperty(p.dependencies[h])?c[p.dependencies[h]]:u[p.dependencies[h]];return t[n]=p.fn.apply(null,l)}};var a=function(e,n,r,t){function o(e){return"$injector"===e||p.hasOwnProperty(e)||f.hasOwnProperty(e)}function s(e,r){return o(e)&&i("Duplicated provider '"+e+"' detected in module '"+module.name+"'."),n.register(e,r),t[e]=n.definitions[e],a}function c(t){return"$injector"===t?u.when(a):p.hasOwnProperty(t)?u.when(p[t]):f.hasOwnProperty(t)?n.resolve(t,r):void i("Module provider '"+t+"' definition is not found in '"+e+"' module.")}function d(t){return"$injector"===t?a:p.hasOwnProperty(t)?p[t]:f.hasOwnProperty(t)?n.resolve_sync(t,r):void i("Module provider '"+t+"' definition is not found in '"+e+"' module.")}var a=this,f=n.definitions,p=r.values;return a.has=o,a.resolve=c,a.register=s,a.resolve_sync=d,a},f={dependencies:d},p=function(n,r,t){if("function"===typeof r)return{fn:r,name:n,dependencies:d};if("string"===typeof r)return{fn:t,name:n,dependencies:[r]};for(var i=r.length-1,o=new e(i+1);i>=0;o[i]=r[i],--i);return{fn:t,name:n,dependencies:o}};default_injectors={values:{$q:u,Array:e,is_array:n,Injector:c,"object.keys":r,"object.assign":t,make_injectable:p,"sorts.topological":o},definitions:{$q:f,Array:f,is_array:f,Injector:f,"object.keys":f,"object.assign":f,make_injectable:f,"sorts.topological":f}},make_module=function(n,r,s){function d(){var e=arguments[0],r=p.apply(null,arguments);return v.hasOwnProperty(e)&&i("'"+e+"' extends already registered in '"+n+"' module."),O[P++]=r,f(v,r),v}function f(n,r){var t=new e(r.dependencies.length);u.for_each_async(r.dependencies,function(e,n,r){g.resolve(e).then(function(e){t[n]=e,r()})}).then(function(){n[r.name]=r.fn.apply(n,t)})}var l,h,y,v={name:n,extend:d},w=new c,O=[],P=0,_={},g=new a(n,w,default_injectors,_),m=[];for(h=o(n,function(e){return s[e]?s[e].requires:n===e?r:void i("'"+e+"' module is not found.")}),y=h.length>1?new e(h.length-1):[],l=0;l<y.length;++l)m=m.concat(s[h[l]].extenders),t(w.definitions,s[h[l]].new_definitions);for(s[n]={name:n,requires:r,instance:v,injector:w,extenders:O,public_injector:g,new_definitions:_},l=0;l<m.length;++l)f(v,m[l]);return v};var l=function(){};return l.prototype={use:function(e){return e(this),this}},{create:function(){function e(e,t){return n(t)?(r.hasOwnProperty(e)&&i("Duplicated module '"+e+"' is detected."),make_module(e,t,r)):(r.hasOwnProperty(e)||i("'"+e+"' module is not found."),r[e].instance)}var r={},t=new l;return t.module=e,t}}}();