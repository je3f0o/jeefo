/**
 * jeefo     : v0.0.9
 * Author    : je3f0o, <je3f0o@gmail.com>
 * Homepage  : https://github.com/je3f0o/jeefo
 * License   : The MIT License
 * Copyright : 2016
 **/
!function(e){window.jeefo=function(){"use strict";var e=Array,n=Object.keys,r=function(e){for(var r,t,i,o=1;o<arguments.length;++o)if(r=arguments[o])for(t=n(r),i=t.length-1;i>=0;--i)e[t[i]]=r[t[i]];return e},t=function(e){throw new Error(e)},i=function(n,r){var i=[],o={};return function s(u,c){var a=c.length-1,d=new e(a+1),f=r(u);for(d[a]=c[a];a>=0;d[a]=c[a],--a);for(d.push(u),o[u]=!0,a=0;a<f.length;++a)d.indexOf(f[a])>=0&&t("Circular dependency '"+f[a]+" is required by '"+n+"' : "+d.join(" -> ")),o.hasOwnProperty(f[a])||s(f[a],d);-1===i.indexOf(u)&&i.push(u)}(n,[]),i},o=function(e){function n(){return 0===i}function r(e,n){return new o(function(r,o){switch(i){case 1:return r(e(t));case 2:return o(n(t));default:s[c]=e,s[c+1]=n,s[c+2]=r,s[c+3]=o,c+=4}})}var t,i=0,s=[],u=this,c=0;return u.then=r,u.state="pending...",u.is_pending=n,e(function(e){if(0===i){i=1,u.state="resolved",u.value=t=e;for(var n=0;n<c;n+=4)e=s[n](t),e&&"JEEFO_PROMISE"===e.type?e.then(s[n+2],s[n+3]):s[n+2](e);s=null,c=0}},function(e){if(0===i){i=2,u.state="rejected",u.reason=t=e;for(var n=1;n<c;n+=4)e=s[n](t),e&&"JEEFO_PROMISE"===e.type?e.then(s[n+1],s[n+2]):s[n+2](e);s=null,c=0}}),u};o.prototype.type="JEEFO_PROMISE";var s={defer:function(){var e={};return e.promise=new o(function(n,r){e.resolve=n,e.reject=r}),e},when:function(e){return e&&"JEEFO_PROMISE"===e.type?e:new o(function(n){n(e)})},for_each_async:function(e,n){function r(){++t<e.length?n.call(e,e[t],t,r,e):i.resolve()}var t=-1,i=this.defer();return r(),i.promise},all:function(e){for(var n,r=0,t=this.defer(),i=0;r<e.length;++r)(n=e[r])&&"JEEFO_PROMISE"===n.type&&(i+=1,n.then(function(n){return function(r){e[n]=r,0===--i&&t.resolve(e)}}(r)));return 0===i&&t.resolve(e),t.promise}},u=function(e){this.values=r({},e),this.definitions={}};u.prototype={register:function(n,r){for(var i=r.dependencies?new e(r.dependencies.length):[],o=i.length-1;o>=0;--o)i[o]=r.dependencies[o];return(this.values.hasOwnProperty(n)||this.definitions.hasOwnProperty(n))&&t("Duplicated provider "+n+" detected."),this.definitions[n]={fn:r.fn,dependencies:i,is_constructor:!!r.is_constructor},this},resolve:function(n,r){var o,u=this.values,c=this.definitions,a=r&&r.values||{},d=r&&r.definitions;return a.hasOwnProperty(n)?a[n]&&"JEEFO_PROMISE"===a[n].type?a[n]:s.when(a[n]):u.hasOwnProperty(n)?u[n]&&"JEEFO_PROMISE"===u[n].type?u[n]:s.when(u[n]):(o=i(n,function(e){return d&&d.hasOwnProperty(e)?d[e].dependencies:c.hasOwnProperty(e)?c[e].dependencies:void t("Injector '"+e+"' definition is not found.")}),s.for_each_async(o,function(n,r,i){var o,s;if(a.hasOwnProperty(n)||u.hasOwnProperty(n))return i();d&&d.hasOwnProperty(n)?(o=a,s=d[n]):(o=u,s=c[n]);for(var f=s.dependencies.length-1,p=new e(f+1);f>=0;--f)a.hasOwnProperty(s.dependencies[f])?p[f]=a[s.dependencies[f]]:u.hasOwnProperty(s.dependencies[f])?p[f]=u[s.dependencies[f]]:t("OMG");var h=s.fn.apply(null,p);s.is_constructor&&(h=new h),h&&"JEEFO_PROMISE"===h.type?h.then(function(e){o[n]=e,i()}):(o[n]=h,i())}).then(function(){return a.hasOwnProperty(n)?a[n]:u[n]}))},resolve_sync:function(n,r){var o,s=this,u=s.values,c=r&&r.values||{},a=s.definitions,d=r&&r.definitions;if(c.hasOwnProperty(n))return c[n];if(u.hasOwnProperty(n))return u[n];d&&d.hasOwnProperty(n)?o=c:a.hasOwnProperty(n)&&(o=u);for(var f=i(n,function(e){return d&&d.hasOwnProperty(e)?d[e].dependencies:a.hasOwnProperty(e)?a[e].dependencies:void t("Injector '"+e+"' definition is not found.")}),p=a[f.pop()],h=new e(p.dependencies.length),l=0;l<f.length;++l)c.hasOwnProperty(f[l])||u.hasOwnProperty(f[l])||s.resolve_sync(f[l],r);for(l=h.length-1;l>=0;--l)h[l]=c.hasOwnProperty(p.dependencies[l])?c[p.dependencies[l]]:u[p.dependencies[l]];return o[n]=p.fn.apply(null,h)}};var c=function(e,n,r,i){function o(e){return"$injector"===e||p.hasOwnProperty(e)||f.hasOwnProperty(e)}function u(e,r){return o(e)&&t("Duplicated provider '"+e+"' detected in module '"+module.name+"'."),n.register(e,r),i[e]=n.definitions[e],d}function c(i){return"$injector"===i?s.when(d):p.hasOwnProperty(i)?s.when(p[i]):f.hasOwnProperty(i)?n.resolve(i,r):void t("Module provider '"+i+"' definition is not found in '"+e+"' module.")}function a(i){return"$injector"===i?d:p.hasOwnProperty(i)?p[i]:f.hasOwnProperty(i)?n.resolve_sync(i,r):void t("Module provider '"+i+"' definition is not found in '"+e+"' module.")}var d=this,f=n.definitions,p=r.values;return d.has=o,d.resolve=c,d.register=u,d.resolve_sync=a,d},a=function(n,r,t){if("function"===typeof r)return{fn:r,name:n,dependencies:[]};if("string"===typeof r)return{fn:t,name:n,dependencies:[r]};for(var i=r.length-1,o=new e(i+1);i>=0;--i)o[i]=r[i];return{fn:t,name:n,dependencies:o}},d={},f={dependencies:[]},p={values:{$q:s,Array:Array,Injector:u,is_array:Array.is_array,"object.keys":n,"object.assign":r,make_injectable:a,"sorts.topological":i},definitions:{$q:f,Array:f,Injector:f,is_array:f,"object.keys":f,"object.assign":f,make_injectable:f,"sorts.topological":f}},h=function(n,o){function f(){var e=arguments[0],r=a.apply(null,arguments);return v.hasOwnProperty(e)&&t("'"+e+"' extends already registered in '"+n+"' module."),P[_++]=r,h(v,r),v}function h(n,r){var t=new e(r.dependencies.length);s.for_each_async(r.dependencies,function(e,n,r){E.resolve(e).then(function(e){t[n]=e,r()})}).then(function(){n[r.name]=r.fn.apply(n,t)})}d.hasOwnProperty(n)&&t("Duplicated module '"+n+"' is detected.");var l,y,w,v={name:n,extend:f},O=new u,P=[],_=0,g={},E=new c(n,O,p,g),j=[];for(y=i(n,function(e){return d[e]?d[e].requires:n===e?o:void t("'"+e+"' module is not found.")}),w=y.length>1?new e(y.length-1):[],l=0;l<w.length;++l)j=j.concat(d[y[l]].extenders),r(O.definitions,d[y[l]].new_definitions);for(d[n]={name:n,requires:o,instance:v,injector:O,extenders:P,public_injector:E,new_definitions:g},l=0;l<j.length;++l)h(v,j[l]);return v},l=function(){};return l.prototype={use:function(e){e(this)},module:h},{create:function(){return new l}}}()}();